---
title: "North Atlantic Swordfish MSE"
author: "Adrian Hordyk <adrian@bluematterscience.com>"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    html_document
---

![](img/220px-Xiphias_gladius2.jpg)

```{=html}
<style>
  .col2 {
    columns: 2 200px;         /* number of columns and width in pixels*/
    -webkit-columns: 2 200px; /* chrome, safari */
    -moz-columns: 2 200px;    /* firefox */
  }
  .col3 {
    columns: 3 100px;
    -webkit-columns: 3 100px;
    -moz-columns: 3 100px;
  }
  .col4 {
    columns: 4 100px;
    -webkit-columns: 4 100px;
    -moz-columns: 4 100px;
  }
</style>
```
```{r setup, include=FALSE}
library(dplyr)
library(pdftools)
knitr::opts_chunk$set(echo = FALSE)


```

## Introduction

Welcome to the North Atlantic Swordfish MSE homepage.

This site contains links to documents, reports, and presentations related to the management strategy evaluation (MSE) process for the North Atlantic Swordfish.

The MSE is being conducted with the open-source [openMSE](https://openmse.com/) framework. The code for the swordfish MSE is available in the `SWOMSE` R package available in the [ICCAT GitHub repository](https://github.com/ICCAT/nswo-mse).


## MSE Process Documentation

1. [Trial Specifications Doc](TS/Trial_Specs.html)

2. [CMP Development Guide (HTML)](cMPdevelopment/CMP-Development-Guide.html)

## Operating Model Reports

### OM Summary Report

### Individual OM Diagnostic Reports
Individual OM diagnostic reports for the 216 Operating Models in the updated OM Uncertainty Grid:

<details>

<summary>Click to expand</summary>


::: col4
```{r, include=FALSE}
fls <- list.files('Reports/OM_Diagnostics', pattern='.html')

num <- NA
for (x in seq_along(fls)) num[x] <- strsplit(fls[x], '-')[[1]][2]
nums <- as.numeric(num[1:(length(num))])
df <- data.frame(fl=fls, num=nums, stringsAsFactors = FALSE)
df <- df %>% dplyr::arrange(num)

```


## Related SCRS Papers

<details>

<summary>Click to expand</summary>

```{r, results='asis'}

get_metadata_paper <- function(pdf) {
  page1 <- pdf_data(pdf)[[1]]
  
  lst.head <- which(grepl('(1|2)\\d{3})', page1$text))
  if (!length(lst.head)) {
    lst.head <- 1
  }
  lst.head <-lst.head[1]
  if (lst.head>20) lst.head <- 1
  page1_nohead <- page1[(lst.head+1):nrow(page1),]
  
  ind <- which(grepl("^[[:upper:]]+$", page1_nohead$text))
  ind <- which(diff(ind)==1)
  ind <- c(ind, max(ind)+1)
  title <- paste0(page1_nohead$text[ind], collapse = ' ')
  
  scrs <- page1$text[1]
  year <- strsplit(scrs, '/')[[1]][2]
  title <- paste0(title,' (', scrs, ')')
  data.frame(title=title, year=year)
  
}


list.papers <- list.files('./SCRS_Papers/')
list.out <- list()
for (i in seq_along(list.papers)) {
  fl <- list.papers[i]
  link <- file.path('./SCRS_Papers/',fl)
  df <- get_metadata_paper(link)
  df$link <- link
  list.out[[i]] <- df
}
df <- do.call('rbind', list.out)

df <- df %>% dplyr::arrange(desc(year))

for (i in 1:nrow(df)) {
  if (i==1) {
    cat('#### ', df$year[i], '\n', sep="")
  } else {
    if (df$year[i]!=df$year[i-1])
      cat('\n#### ', df$year[i], '\n', sep="")
  }
  cat('\n 1. [', df$title[i], '](', df$link[i], ')', '\n', sep="")
  
}


```


## Meeting Reports

<details>

<summary>Click to expand</summary>

```{r, results='asis'}

get_title_report <- function(pdf) {
  page1 <- pdf_data(pdf)[[1]]
  page1_title <- page1 %>% filter(height >10) 
  begin_ab <- min(which(grepl('\\â€œ', page1_title$text)))
  title <- page1_title$text[1:(begin_ab-1)]
  paste0(title, collapse = ' ')
}


list.reports <- list.files('./Meeting_Reports/')
list.out <- list()
for (i in seq_along(list.reports)) {
  fl <- list.reports[i]
  link <- file.path('./Meeting_Reports/',fl)
  title <- get_title_report(link)
  year <- strsplit(fl, "_")[[1]][1]
  list.out[[i]] <- data.frame(year=year,
                              title=title,
                              link=link)
}
df <- do.call('rbind', list.out)

df <- df %>% dplyr::arrange(desc(year))

for (i in 1:nrow(df)) {
  if (i==1) {
    cat('### ', df$year[i], '\n', sep="")
  } else {
    if (df$year[i]!=df$year[i-1])
      cat('\n### ', df$year[i], '\n', sep="")
  }
  cat('\n 1. [', df$title[i], '](', df$link[i], ')', '\n', sep="")
  
}

```



```{r, results='asis'}
for (i in 1:nrow(df)) {
  nm <- strsplit(df[i,1], '.html')[[1]][1]
  fl <- paste0('Reports/OM_Diagnostics/', df[i,1])
  cat('\n[',nm,'](',fl,')\n', sep="")
}
```

:::
</details>
