---
title: "Swordfish Length Composition Data"
author: "Adrian Hordyk"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

```{r, include=FALSE}
library(SWOMSE)
library(ggplot2)
knitr::opts_chunk$set(echo = FALSE)
```

## % of Lengths < 119 and 125 (all years)
```{r}
Comps <-  SWOMSE::LenDat_List[[1]] %>% group_by(Name, Bin, year) %>%
  summarize(Obs=sum(Obs), Exp=sum(Exp), .groups='keep')

DF <- Comps %>% dplyr::group_by(Name) %>% 
  summarize('<=119'=round(sum(Obs[Bin <=119])/sum(Obs),2)*100,
            '<=125'=round(sum(Obs[Bin <=125])/sum(Obs),2)*100, .groups='keep') 

knitr::kable(DF)
```

## % of Lengths < 119 and 125 (1993+)
```{r}
Comps <-  SWOMSE::LenDat_List[[1]] %>% group_by(Name, Bin, year) %>%
  dplyr::filter(year>=1993) %>%
  summarize(Obs=sum(Obs), Exp=sum(Exp), .groups='keep')

DF <- Comps %>% dplyr::group_by(Name) %>% 
  summarize('<=119'=round(sum(Obs[Bin <=119])/sum(Obs),2)*100,
            '<=125'=round(sum(Obs[Bin <=125])/sum(Obs),2)*100, .groups='keep') 

knitr::kable(DF)
```



## % Below 119 and 125 by Fleet and Year
```{r, fig.height=9, fig.width=9}
DF2 <- Comps %>% dplyr::group_by(Name, year) %>% 
  summarize(`119`=sum(Obs[Bin <=119])/sum(Obs),
            `125`=sum(Obs[Bin <=125])/sum(Obs), .groups='keep')

library(ggplot2)
DF2 <- tidyr::pivot_longer(DF2, 3:4)

ggplot(DF2, aes(x=year, y=value*100, linetype=name)) + 
  geom_line() +
  facet_wrap(~Name, ncol=4) +
  expand_limits(y=c(0,100)) +
  theme_bw() +
  labs(x="Year", y="%", linetype="% below")

```

## Histograms of Size Composition by Fleet and Year

Dashed vertical line = 119 cm

Dotted vertical line = 125 cm

```{r, fig.height=12, fig.width=9}
nms <- unique(Comps$Name)

for (nm in nms) {
  dat <- Comps %>% dplyr::filter(Name == nm)
  p1 <- ggplot(dat, aes(x=Bin, y=Obs)) +
    facet_wrap(~year, ncol=4) +
    geom_bar(stat='identity') +
    geom_vline(xintercept=119 ,linetype=2)+
    geom_vline(xintercept=125 ,linetype=3)+
    theme_bw() +
    labs(title = nm) 
  
  print(p1)
  
  
  # ggsave(paste0('img/LengthComps/', nm, '.png'), p1)
}
```

